/* eslint-disable */
(function (w) {
  /*tagconfig*/
  var config = {
    "heightRatio": 1.7777777777777777,
    "caption": {},
    "adConfig": {
      "adServerDomain": "serv.vidcrunch.com",
      "channelId": '634940ab99e51b191405b449',
      "customLogo": {
        "clickthrough": "https://vidcrunch.com",
        "height": 14,
        "link": "https://cdn.vidcrunch.com/assets/playlist-logo.svg",
        "text": "",
        "width": 100,
        "right": 6,
        "top": 20,
      },
      "errorLimit": 23,
      "imarpm": 20,
      "logo": false,
      "maxBidQueue": 4,
      "pauseButton": false,
      "publisherId": '634936faec0fcd1c8d63f374',
      "ref1": 'AV_DNTCHECK=1',
      "reqOnView": false,
      "skip": true,
      "skipText": 'Skip This Ad',
      "skipTimer": 5,
      "soundButton": true,
      "startmidroll": 15,
      "startdelay": 0,
      "preroll": 0,
      "prerolltimeout": 0,
      "midrolltime": 0,
      "midrolldelay": 0,
      "timelineMode": 'bottom',
      "trackDomain": "servt.vidcrunch.com",
      "vastRetry": 3,
      "vitab": true,
      "height": 0,
      "width": 100
    },
    "startmidroll": 15,
    "startdelay": 0,
    "preroll": 0,
    "prerolltimeout": 0,
    "midrolltime": 0,
    "midrolldelay": 0,
    "height": 0,
    "width": 100,
    "adServerDomain": "serv.vidcrunch.com",
    "autoContinue": true,
    "autoLoop": true,
    "autoPlay": true,
    "autoSkip": {"time":40,"timeout":10},
    "closeButton": false,
    "closeButtonStyle": {
      "left": 0,
      "outside": true,
      "overlayMargin": 30,
      "position": 'Top-Right',
      "right": 0
    },
    "content": {
      "breakingAds": 5,
      "breakingAdsMode": 'os',


      "contents": [{"id":0,"url":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/4fb4c088973bd226af9fba43436e515b.mp4?channelId=634940ab99e51b191405b449&veid=a7678f04fadd27f10a96584408d92fb8","clickThroughUrl":"","type":"video","entry":{"thumbnailUrl":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/4b0a6e4aac9dd9a98891d43620d4d4e0_1.jpg?channelId=634940ab99e51b191405b449&veid=a7678f04fadd27f10a96584408d92fb8","name":"The Philippines Central Islands by Drone, Part 1","userExpand":{"fullName":""}}},{"id":1,"url":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/91548d640f75aaf1e9814cb5293177e7.mp4?channelId=634940ab99e51b191405b449&veid=2511935bc7da407845b75ca9fab91f08","clickThroughUrl":"","type":"video","entry":{"thumbnailUrl":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/33f379cfc865ba641a3fc09a600faa5e_1.jpg?channelId=634940ab99e51b191405b449&veid=2511935bc7da407845b75ca9fab91f08","name":"Exploring the Philippines by Drone","userExpand":{"fullName":""}}},{"id":2,"url":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/8848309fe8062644a01a9935e2e398c4.mp4?channelId=634940ab99e51b191405b449&veid=5374304b4d6a289e26ae7291a7857a14","clickThroughUrl":"","type":"video","entry":{"thumbnailUrl":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/a088e6b20e8922e4d4389c40051fc20f_1.jpg?channelId=634940ab99e51b191405b449&veid=5374304b4d6a289e26ae7291a7857a14","name":"Why You Should Ignore This Travel Advice","userExpand":{"fullName":""}}},{"id":3,"url":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/f9a406ec138a4c354014b5b92f7e1fd8.mp4?channelId=634940ab99e51b191405b449&veid=031fcd8dcd6c6b4088dc31cbffd76124","clickThroughUrl":"","type":"video","entry":{"thumbnailUrl":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/bf2dcae12a816bbabdc01b141e89275b_1.jpg?channelId=634940ab99e51b191405b449&veid=031fcd8dcd6c6b4088dc31cbffd76124","name":"You Have to Check Out This Amazing Bridge in Germany","userExpand":{"fullName":""}}}],
      "firstPrerollSlot": {
        "maxAds": 0,
        "time": 0,
      },
      "order": 1,
      "randomFrom": 1,
      "type": 0
    },
    "customCss": '',
    "durationPosition": 'left',
    "floating": {
      "backgroundColor": 'white',
      "bottom": 135,
      "closeButton": true,
      "floatOnBottom": true,
      "floatOnView": true,
      "height": 0,
      "left": 0,
      "position": 'Bottom-Right',
      "resize": true,
      "right": 8,
      "top": 0,
      "size": 0.6,
      "textColor": 'black',
      "textFont": "Roboto, Arial, sans-serif",
      "textSize": 19,
      "width": 0
    },
    "gpid": 'global-placement-id',
    "hideGuiTimeout": 3,
    "logo": {"clickThrough":"https://vidcrunch.com","position":"top-right","size":[100,43],"text":"","url":"https://cdn.vidcrunch.com/assets/playlist-logo.svg"},
    "maxWidth": '640',
    "minHeight": 180,
    "mobile": {
      "hideGuiTimeout": 0,
      "showBigPlay": true,
      "showBigPlayOnPause": true,
      "showBigPrevNext": true,
      "showFullScreen": true,
      "showNextButton": true,
      "showPauseButton": true,
      "showPrevButton": true
    },
    "moveXSec": false,
    "noPauseOnClickthrough": false,
    "playerDelay": 0,
    "playerType": 2,
    "playerVersion": 8,
    "playlistPlacement": 'outside',
    "playlistOrientation": 'horizontal',
    "playlistAlignment": 'end',
    "playOnView": true,
    "playOnViewPerc": 30,
    "posDfp1x1": false,
    "position": 'aniplayer_vidcrunchJS720414822',
    "posCounter": 1,
    "posSelector": '',
    "posType": 'in',
    "scriptId": 'vidcrunchJS720414822',
    "showBigPlay": true,
    "showBigPlayOnPause": true,
    "showBigPrevNext": true,
    "showBigPrevNextOnPause": true,
    "showDuration": true,
    "showFullScreen": true,
    "showNextButton": true,
    "showPauseButton": true,
    "showPlaylist": false,
    "showPlaylistButton": false,
    "showPlaylistItemTitle": true,
    "showPrevButton": true,
    "showReplay": true,
    "showSoundButton": true,
    "showTitle": false,
    "showVolumeControl": true,
    "soundButtonPosition": 'right',
    "spinner": 1,
    "startMode": {"hidden":false,"mode":"WaitForAd","noFloat":false,"openAnim":false,"playButtonDelay":0,"playOnView":false,"showPlayer":true},
    "startVolume": 0,
    "sticky": {
      "backgroundColor": 'transparent',
      "bottom": 0,
      "left": 0,
      "position": '',
      "right": 0,
      "size": 0,
      "textColor": 'White',
      "textFont": "Roboto, Arial, sans-serif",
      "textSize": 19,
      "top": 0
    },
    "syncVolume": false,
    "timelineMode": 'bottom',
    "trackDomain": "servt.vidcrunch.com",
    "tracking": {
      "enabled": true
    },
    "volumeControlVertical": false,
    "waitForConsent": false,
    "xSec": 15
  };
  var b = [
    {
      t: { p: 1 },
      a: {
        "heightRatio": 1.7777777777777777,
        "caption": {},
        "adConfig": {
          "adServerDomain": "serv.vidcrunch.com",
          "channelId": '634940ab99e51b191405b449',
          "customLogo": {
            "clickthrough": "https://vidcrunch.com",
            "height": 14,
            "link": "https://cdn.vidcrunch.com/assets/playlist-logo.svg",
            "text": "",
            "width": 100,
            "right": 6,
            "top": 20,
          },
          "errorLimit": 23,
          "imarpm": 20,
          "logo": false,
          "maxBidQueue": 4,
          "pauseButton": false,
          "publisherId": '634936faec0fcd1c8d63f374',
          "ref1": 'AV_DNTCHECK=1',
          "reqOnView": false,
          "skip": true,
          "skipText": 'Skip This Ad',
          "skipTimer": 5,
          "soundButton": true,
          "startmidroll": 15,
          "startdelay": 0,
          "preroll": 0,
          "prerolltimeout": 0,
          "midrolltime": 0,
          "midrolldelay": 0,
          "timelineMode": 'bottom',
          "trackDomain": "servt.vidcrunch.com",
          "vastRetry": 3,
          "vitab": true,
          "height": 0,
          "width": 100
        },
        "startmidroll": 15,
        "startdelay": 0,
        "preroll": 0,
        "prerolltimeout": 0,
        "midrolltime": 0,
        "midrolldelay": 0,
        "height": 0,
        "width": 100,
        "adServerDomain": "serv.vidcrunch.com",
        "autoContinue": true,
        "autoLoop": true,
        "autoPlay": true,
        "autoSkip": {"time":40,"timeout":10},
        "closeButton": false,
        "closeButtonStyle": {
          "left": 0,
          "outside": true,
          "overlayMargin": 30,
          "position": 'Top-Right',
          "right": 0
        },
        "content": {
          "breakingAds": 5,
          "breakingAdsMode": 'os',


          "contents": [{"id":0,"url":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/4fb4c088973bd226af9fba43436e515b.mp4?channelId=634940ab99e51b191405b449&veid=a7678f04fadd27f10a96584408d92fb8","clickThroughUrl":"","type":"video","entry":{"thumbnailUrl":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/4b0a6e4aac9dd9a98891d43620d4d4e0_1.jpg?channelId=634940ab99e51b191405b449&veid=a7678f04fadd27f10a96584408d92fb8","name":"The Philippines Central Islands by Drone, Part 1","userExpand":{"fullName":""}}},{"id":1,"url":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/91548d640f75aaf1e9814cb5293177e7.mp4?channelId=634940ab99e51b191405b449&veid=2511935bc7da407845b75ca9fab91f08","clickThroughUrl":"","type":"video","entry":{"thumbnailUrl":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/33f379cfc865ba641a3fc09a600faa5e_1.jpg?channelId=634940ab99e51b191405b449&veid=2511935bc7da407845b75ca9fab91f08","name":"Exploring the Philippines by Drone","userExpand":{"fullName":""}}},{"id":2,"url":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/8848309fe8062644a01a9935e2e398c4.mp4?channelId=634940ab99e51b191405b449&veid=5374304b4d6a289e26ae7291a7857a14","clickThroughUrl":"","type":"video","entry":{"thumbnailUrl":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/a088e6b20e8922e4d4389c40051fc20f_1.jpg?channelId=634940ab99e51b191405b449&veid=5374304b4d6a289e26ae7291a7857a14","name":"Why You Should Ignore This Travel Advice","userExpand":{"fullName":""}}},{"id":3,"url":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/f9a406ec138a4c354014b5b92f7e1fd8.mp4?channelId=634940ab99e51b191405b449&veid=031fcd8dcd6c6b4088dc31cbffd76124","clickThroughUrl":"","type":"video","entry":{"thumbnailUrl":"https://cdn.vidcrunch.com/integrations/5f7dbe211a17257c47e4ceba/634948cbbd94793a16200988/bf2dcae12a816bbabdc01b141e89275b_1.jpg?channelId=634940ab99e51b191405b449&veid=031fcd8dcd6c6b4088dc31cbffd76124","name":"You Have to Check Out This Amazing Bridge in Germany","userExpand":{"fullName":""}}}],
          "firstPrerollSlot": {
            "maxAds": 0,
            "time": 0,
          },
          "order": 1,
          "randomFrom": 1,
          "type": 0
        },
        "customCss": '',
        "durationPosition": 'left',
        "floating": {
          "backgroundColor": 'white',
          "bottom": 135,
          "closeButton": true,
          "floatOnBottom": true,
          "floatOnView": true,
          "height": 0,
          "left": 0,
          "position": 'Bottom-Right',
          "resize": true,
          "right": 8,
          "top": 0,
          "size": 0.6,
          "textColor": 'black',
          "textFont": "Roboto, Arial, sans-serif",
          "textSize": 19,
          "width": 0
        },
        "gpid": 'global-placement-id',
        "hideGuiTimeout": 3,
        "logo": {"clickThrough":"https://vidcrunch.com","position":"top-right","size":[100,43],"text":"","url":"https://cdn.vidcrunch.com/assets/playlist-logo.svg"},
        "maxWidth": '640',
        "minHeight": 180,
        "mobile": {
          "hideGuiTimeout": 0,
          "showBigPlay": true,
          "showBigPlayOnPause": true,
          "showBigPrevNext": true,
          "showFullScreen": true,
          "showNextButton": true,
          "showPauseButton": true,
          "showPrevButton": true
        },
        "moveXSec": false,
        "noPauseOnClickthrough": false,
        "playerDelay": 0,
        "playerType": 2,
        "playerVersion": 8,
        "playlistPlacement": 'outside',
        "playlistOrientation": 'horizontal',
        "playlistAlignment": 'end',
        "playOnView": true,
        "playOnViewPerc": 30,
        "posDfp1x1": false,
        "position": 'aniplayer_vidcrunchJS720414822',
        "posCounter": 1,
        "posSelector": '',
        "posType": 'in',
        "scriptId": 'vidcrunchJS720414822',
        "showBigPlay": true,
        "showBigPlayOnPause": true,
        "showBigPrevNext": true,
        "showBigPrevNextOnPause": true,
        "showDuration": true,
        "showFullScreen": true,
        "showNextButton": true,
        "showPauseButton": true,
        "showPlaylist": false,
        "showPlaylistButton": false,
        "showPlaylistItemTitle": true,
        "showPrevButton": true,
        "showReplay": true,
        "showSoundButton": true,
        "showTitle": false,
        "showVolumeControl": true,
        "soundButtonPosition": 'right',
        "spinner": 1,
        "startMode": {"hidden":false,"mode":"WaitForAd","noFloat":false,"openAnim":false,"playButtonDelay":0,"playOnView":false,"showPlayer":true},
        "startVolume": 0,
        "sticky": {
          "backgroundColor": 'transparent',
          "bottom": 0,
          "left": 0,
          "position": '',
          "right": 0,
          "size": 0,
          "textColor": 'White',
          "textFont": "Roboto, Arial, sans-serif",
          "textSize": 19,
          "top": 0
        },
        "syncVolume": false,
        "timelineMode": 'bottom',
        "trackDomain": "servt.vidcrunch.com",
        "tracking": {
          "enabled": true
        },
        "volumeControlVertical": false,
        "waitForConsent": false,
        "xSec": 15
      },
      sp: 0,
    },
  ];

  var ab = {};
  var ad = {};

  var playerElement;

  /*tagconfig*/
  var a = config;
  var st = {
    target: function () {
      if (this.sp) {
        return;
      }
      var ua = navigator.userAgent || navigator.vendor || window.opera;
      var uav = navigator.appVersion ? navigator.appVersion.toLowerCase() : '';
      var op = 2;
      if (
        /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(
          ua,
        ) ||
        /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(
          ua.substr(0, 4),
        )
      ) {
        op = 1;
      } else {
        if (/web0s|webos|tizen/i.test(uav)) {
          op = 4;
        }
      }
      this.op = op;
    },
    getConfig: function () {
      function getRC(ab) {
        if (ab && ab.length) {
          var inc = 0;
          var rand = Math.floor(Math.random() * 100) + 1;
          for (i = 0; i < ab.length; i++) {
            b1 = ab[i];
            inc += b1.sp;
            if (b1.a && inc >= rand) {
              return b1.a;
            }
          }
        }
      }

      function merge(target, source) {
        if (typeof source !== 'object' || Array.isArray(source)) return target;
        for (var key in source) {
          if (typeof source[key] === 'object' && !Array.isArray(source[key])) {
            if (!target[key]) Object.assign(target, { [key]: {} });
            merge(target[key], source[key]);
          } else {
            Object.assign(target, { [key]: source[key] });
          }
        }
      }

      var cfg = config;
      try {
        var i, b1;
        if (b && b.length > 0) {
          st.target();
          for (i = 0; i < b.length; i++) {
            b1 = b[i];
            if (b1.t && b1.t.p && b1.t.p == this.op && b1.a) {
              return b1.a;
            }
          }
        }

        var r1 = getRC(ab) || cfg;
        if (typeof ad !== 'undefined' && ad.length > 0) {
          var r2 = getRC(ad);
          merge(r1, r2);
        }
        return r1;
      } catch (e) { }

      return cfg;
    },
    track: function (e, m) {
      if (!this.trackUrl) {
        this.trackUrl =
          'https://' +
          (a.trackDomain || 'track1.aniview.com') +
          '/track?pid=' +
          a.adConfig.publisherId +
          '&cid=' +
          a.adConfig.channelId +
          '&cb=' +
          Date.now() +
          '&r=' +
          location.host +
          '&stagid=' +
          (a.tagId || '') +
          '&stplid=' +
          (a.templateId || '') +
          '&d35=' +
          (a.adConfig.sabTest || '') +
          '&d65=' +
          (a.adConfig.nabTest || '') +
          '&d66=' +
          a.playerVersion +
          '&e=';
      }
      m = m ? m : '';
      new Image().src = this.trackUrl + e + m;
    },
    unique: function () {
      if (!this.win.aniplayerPos) this.win.aniplayerPos = {};
      this.win.aniplayerPos[a.position] = true;
      return true;
    },
    findWin: function () {
      try {
        if (
          (!a.posDfp1x1 &&
            !a.posClass &&
            !a.posSelector &&
            !a.posId &&
            !a.posTag) ||
          w === top ||
          !w.frameElement
        ) {
          this.doc = document;
          this.win = w;
        } else if (a.posDfp1x1 && w.frameElement) {
          this.win = parent;
          this.doc = parent.document;
        } else {
          this.win = top;
          this.doc = top.document;
        }
      } catch (f) {
        this.doc = document;
        this.win = w;
      }
    },
    postCreate: function () { },
    retry: function () {
      if (this.retryCnt++ > this.timeout) {
        this.track(
          'AV_M3',
          '&prbdres=nopos&sn=' +
          encodeURIComponent(location.href).slice(0, 400),
        );
        return;
      }
      var that = this;
      setTimeout(function () {
        that.position();
      }, 250);
    },
    create: function (p, n) {
      var d1 = document.createElement('div');
      if (a.scriptId) {
        d1.className = a.scriptId;
      }
      d1.style.width = '100%';
      d1.style.margin = '0 auto';
      d1.style.maxWidth = '' + a.maxWidth + 'px';
      var d2 = document.createElement('div');
      d2.id = 'aniBox';
      var d3 = document.createElement('div');
      d3.id = a.position;
      if (p === this.doc || p === this.doc.head) p = this.doc.body;
      if (n) {
        p.insertBefore(d1, n);
      } else {
        p.appendChild(d1);
      }
      a.refDiv = p;
      d1.appendChild(d2);
      d2.appendChild(d3);
      this.postCreate(d1);

      playerElement = d1;
      console.log(typeof playerElement);
    },
    position: function () {
      var p = this.doc;
      if (a.posSelector) {
        try {
          var q = this.doc.querySelectorAll(a.posSelector);
          var l = 0;
          if (a.posCounter > 0) {
            l = a.posCounter - 1;
          }
          p = q[l];
        } catch (e) {
          this.track(
            'AV_M3',
            '&prbdres=badpos&sn=' +
            encodeURIComponent(location.href).slice(0, 400),
          );
          return;
        }
        if (!p) {
          this.retry();
          return;
        }
      }
      if (a.posId) {
        p = this.doc.getElementById(a.posId);
        if (!p) {
          this.retry();
          return;
        }
      }
      if (a.posTag) {
        var c = a.posTag.split('#');
        if (c && c.length == 2) {
          var e = p.getElementsByTagName(c[0]);
          if (e.length == 0) {
            this.retry();
            return;
          }
          p = e[Math.min(c[1] - 1, e.length - 1)];
        }
      }
      if (a.posClass) {
        var c = a.posClass.split('#');
        var e = 1;
        if (c.length == 2) {
          e = c[1];
        }
        var f = p.getElementsByClassName(c[0]);
        if (f.length > 0) {
          p = f[Math.min(e - 1, f.length - 1)];
        }
        if (!p) {
          this.retry();
          return;
        }
      }
      if (a.posDfp1x1 && window.frameElement) {
        n = window.frameElement.parentNode.parentNode;
        p = n.parentNode;
        if (
          (frameElement.clientHeight > 5 || document.body.clientHeight > 5) &&
          !a.nohideIframe
        ) {
          frameElement.style.height = '0px';
        }
        if (a.posType == 'after') {
          n = n.nextElementSibling;
        }
      }
      var n;
      if (p === this.doc) {
        n = this.doc.getElementById(a.scriptId);
        if (n) {
          n.id += '-used';
          p = n.parentNode;
        }
      }
      if (p === this.doc.head) {
        n = null;
        p = this.doc;
      }
      if (a.posType && a.posType !== 'in' && !n) {
        if (a.posType === 'after' && p.nextElementSibling) {
          n = p.nextElementSibling;
        } else {
          n = null;
        }
        p = p.parentNode;
      }
      if (p) {
        if (!p.av_setpos) {
          p.av_setpos = {};
        }
        if (!p.av_setpos[a.position]) {
          p.av_setpos[a.position] = true;
          a.position += '-' + Date.now();
          this.create(p, n);
          this.load(a.playerVersion);
        } else {
          this.track(
            'AV_M3',
            '&prbdres=duppos&sn=' +
            encodeURIComponent(location.href).slice(0, 400),
          );
        }
      }
    },
    fetchContent: function (callback) {
      if (a.content && (a.content.cmsId && a.content.cmsType)) {
        a.content.contentFeed =
          'https://' +
          (a.cmsFeedDomain || 'feed.avplayer.com') +
          '/backend/get?cmsType=' +
          a.content.cmsType +
          '&id=' +
          a.content.cmsId +
          '&AV_TAGID=' +
          this.config.tagId +
          '&pid=' +
          this.config.adConfig.publisherId +
          '&cid=' +
          this.config.adConfig.channelId +
          '&AV_TEMPID=' +
          this.config.templateId;
        if (a.content.firstVideoId) {
          a.content.contentFeed += '&firstVideoId=' + a.content.firstVideoId;
        }
        if (a.content.cmsSyndicationId) {
          a.content.contentFeed +=
            '&syndicationId=' + a.content.cmsSyndicationId;
        }
        if (a.adConfig && a.adConfig.publisherId) {
          a.content.contentFeed += '&AV_PUBLISHERID=' + a.adConfig.publisherId;
        }
      }
      if (a.content.contentFeed) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', a.content.contentFeed, true);
        xhr.onload = function () {
          xhr.onload = null;
          try {
            var json = JSON.parse(xhr.responseText);
            if (json && json.playlist) {
              a.content.contents = json.playlist;
            }
          } catch (e) { }
          callback();
        };
        xhr.send();
      } else {
        callback();
      }
    },
    load: function (playerVersion) {
      var that = this;
      var baseJsUrl =
        'https://player.avplayer.com/script/' +
        (playerVersion >= 8 ? playerVersion : 2) +
        '/v/';
      var loadCounter = 0;
      var errorCounter = 0;
      function checkIfLoad() {
        if (++loadCounter > 1) {
          that.init(playerVersion);
        }
      }
      function checkIfError() {
        if (++errorCounter < 2) {
          fetchScript(a.baseJsUrl || baseJsUrl);
        } else if (errorCounter < 4) {
          fetchScript(baseJsUrl);
        } else if (errorCounter < 16) {
          setTimeout(function () {
            fetchScript(baseJsUrl);
          }, 5000);
        }
      }
      function fetchScript(baseJsUrl) {
        var scp = that.doc.createElement('script');
        var rand = Math.floor(Math.random() * 100) + 1;
        if (rand < 5 && playerVersion >= 8) {
          baseJsUrl += 'ab5/';
        }
        scp.src = baseJsUrl + 'avcplayer.js';
        scp.onload = function () {
          scp.onload = null;
          checkIfLoad();
        };
        scp.onerror = function () {
          scp.onerror = null;
          that.doc.body.removeChild(scp);
          checkIfError();
        };
        scp.async = true;
        that.doc.body.appendChild(scp);
      }
      this.fetchContent(checkIfLoad);
      fetchScript(a.baseJsUrl || baseJsUrl);
    },
    postStart: function (player) {
      console.log();
    },
    getAttr: function () {
      if (a.scriptId) {
        var s =
          document.getElementById(a.scriptId) ||
          document.getElementById(a.scriptId + '-used');
        if (s) {
          for (var i = 0, t = s.attributes; i < s.attributes.length; i++) {
            if (t[i].nodeName && t[i].nodeName.indexOf('data-') == 0) {
              var n = t[i].nodeName
                .replace(/^data-/, '')
                .replace(/[-_]+?(\w)/g, function (_, letter) {
                  return letter.toUpperCase();
                })
                .split('.');
              var lastProp = n.pop();
              try {
                var innerConfig = n.reduce(function (a, prop) {
                  return a[prop];
                }, a);
                innerConfig[lastProp] = t[i].nodeValue;
              } catch (e) { }
            }
          }
          if (s.src) {
            var p = s.src.indexOf('?');
            if (p > 10) {
              var r = s.src.substring(p + 1, s.src.length);
              a.adConfig.ref1 = (a.adConfig.ref1 || '') + '&' + (r || '');
            }
          }
        }
      }
    },
    start: function (player) {
      this.p = player;
      if (this.pbjs && this.pbjs.preparePlayer) {
        this.pbjs.preparePlayer(player, st);
      }
      if (a.playerApi && typeof this.win[a.playerApi] === 'function') {
        try {
          this.win[a.playerApi](a, player);
        } catch (ex) { }
      }
      player.nextContent();
      this.postStart(player);
    },
    preRun: function () { },
    run: function () {
      this.config = a = config = this.getConfig();
      this.a = a;
      this.getAttr();
      this.preRun();
      this.findWin();
      if (!this.doc.body) {
        this.doc.addEventListener('DOMContentLoaded', function () {
          st.run();
        });
        if (this.bodyRetry > 0) {
          setTimeout(function () {
            st.run();
          }, 250);
          this.domRetry--;
        }
        return;
      }
      if (a.configApi && typeof this.win[a.configApi] === 'function') {
        try {
          this.win[a.configApi](a);
        } catch (ex) { }
      }
      if (this.unique() && !this.loaded) {
        this.loaded = true;
        this.track('playerLoaded');
        this.retryCnt = 0;
        this.timeout = a.posTimeout || 40;
        this.pbjs =
          window.aniviewRenderer &&
          window.aniviewRenderer.units &&
          window.aniviewRenderer.units[a.scriptId];
        if (this.pbjs && this.pbjs.prepareConfig) {
          this.pbjs.prepareConfig(a, st);
        }
        this.position();
      }
    },
    init: function (playerVersion) {
      var that = this;
      this.getAttr();
      var isNewPlayer = playerVersion >= 8;
      var playerApiName = isNewPlayer ? 'avContentPlayer' : '_avcp';
      function initPlayer(playerApi) {
        return playerApi.createPlayer().then(function (playerClass) {
          that.start(new playerClass(a));
        });
      }
      function findPlayerApi(playerApiName) {
        var apiClass;
        var fallbackApiClass;
        try {
          if (that.win[playerApiName]) {
            apiClass = that.win[playerApiName];
          } else if (window[playerApiName]) {
            apiClass = window[playerApiName];
          } else {
            apiClass = top[playerApiName];
          }
        } catch (exp) {
          try {
            fallbackApiClass = window[playerApiName];
          } catch (exp) { }
        }
        return { apiClass: apiClass, fallbackApiClass: fallbackApiClass };
      }
      var playerApi = findPlayerApi(playerApiName);
      var playerApiClass = playerApi.apiClass;
      var playerApiFallbackClass = playerApi.fallbackApiClass;
      if (isNewPlayer && !playerApiClass && !playerApiFallbackClass) {
        playerApi = findPlayerApi('_avcp');
        playerApiClass = playerApi.apiClass;
        playerApiFallbackClass = playerApi.fallbackApiClass;
        isNewPlayer = false;
        if (!playerApiClass && !playerApiFallbackClass) {
          a.baseJsUrl = null;
          that.load(7);
          return;
        }
      }
      if (isNewPlayer) {
        try {
          initPlayer(playerApiClass).catch(function () {
            initPlayer(playerApiFallbackClass);
          });
        } catch (e) {
          initPlayer(playerApiFallbackClass);
        }
      } else {
        var player;
        try {
          player = new playerApiClass(a);
        } catch (e) {
          player = new playerApiFallbackClass(a);
        }
        that.start(player);
      }
    },
    domRetry: 20,
  };
  if (a.playerDelay > 0) {
    setTimeout(function () {
      st.run();
    }, a.playerDelay * 1000);
  } else {
    st.run();
  }
})(window);
